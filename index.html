<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>To Do List</title>
  </head>
  <style>
    .taskDone{
      text-decoration: line-through;
    }
  
  </style>
  <body onload="gettasks()">
    <div id="app"></div>
    <div class="toDo-container">
      <input type="text" name="toDotask" id="toDotask">
      <input type="date" name="date" id="date">
      <input type="button" value="Add" onclick="add()">
           <div class='tasks' id="tasks">
           </div>
           <input type="button" value="clear" onclick="clearAll()">
    </div>
    <script>
        var allTasks=[];
      
        function createtask(content,date){
        const tasks=document.getElementById('tasks');
        const newtask_container=document.createElement('div');
        newtask_container.id='newtask_container';
        newtask_container.innerHTML=`
      <input type='checkbox' name='taskcheck' id='taskcheck' onchange='taskDone(this)'>
      <div id='task'>
      <p id='taskcontent'>${content}</p>
      <input type='date' onchange="editDate(this)"  id='datechange' value='${date}'>
      </div>
      <input type='button' value='Edit' onclick='edit(this)'>
      <input type='button' value='delete' onclick='ondelete(this)'>`;
     tasks.appendChild(newtask_container);
    document.getElementById('toDotask').value='';

    localStorage.setItem("session",JSON.stringify(allTasks) )
      }

      function addTask(content,date){
      let newtask={
        content:content,
        date:date,
        etat:false
      }
      allTasks.push(newtask);
      }
 
      function gettasks(){
        var tasksbylocalstorage=localStorage.getItem("session");
        if(tasksbylocalstorage){
          JSON.parse(tasksbylocalstorage).forEach(task=>{
            addTask(task.content,task.date)
         });
        allTasks.forEach(element => {
          createtask(element.content,element.date)
        });   }
      }
      function add(){
  addTask(document.getElementById('toDotask').value,document.getElementById('date').value);
  createtask(document.getElementById('toDotask').value,document.getElementById('date').value)
}


function ondelete(button){
const taskDelete=button.parentNode;
const indexToDelete = Array.from(taskDelete.parentNode.children).indexOf(taskDelete);
if(indexToDelete!=-1){
  allTasks.splice(indexToDelete,1);
  localStorage.setItem("session",JSON.stringify(allTasks))
document.getElementById('tasks').removeChild(taskDelete);

}


}
function taskDone(task){
  const taskDone=task.parentNode.querySelector("#task");
  const taskUpdate=task.parentNode;
  const indexTask=Array.from(taskUpdate.parentNode.children).indexOf(taskUpdate);
  let isDone = allTasks[indexTask].etat;
 console.log(indexTask);
  if (!isDone) {
    taskDone.classList.add("taskDone");
   
  }
  else{
    taskDone.classList.remove("taskDone"); 
  }
  allTasks[indexTask].etat=!isDone;
  localStorage.setItem("session",JSON.stringify(allTasks))

}
function edit(text){
 let updatedText=text.parentNode;
const indexToUpdate = Array.from(updatedText.parentNode.children).indexOf(updatedText);
const editText=text.parentNode.querySelector('#taskcontent');
const editZone=text.parentNode.querySelector('#task');
editText.contentEditable="true";
editText.focus();

editZone.addEventListener('input',()=>{
  localStorage.setItem("session",JSON.stringify(allTasks))

  allTasks[indexToUpdate].content=editText.innerText;
})
editZone.addEventListener('blur',()=>{
  editText.contentEditable="false";

})
}
function editDate(calender){
let updatedDate=calender.parentNode.parentNode;
const indextoUpdate=Array.from(updatedDate.parentNode.children).indexOf(updatedDate);
console.log(indextoUpdate);
const newDate=calender.value;
if(indextoUpdate!=-1){
  allTasks[indextoUpdate].date=newDate;
  localStorage.setItem("session",JSON.stringify(allTasks));

}

}
function clearAll(){
  localStorage.clear();
  allTasks=[];
  document.getElementById('tasks').innerHTML="";
}
    </script>
    <script type="module" src="/main.js">
 
    </script>
  </body>
</html>
